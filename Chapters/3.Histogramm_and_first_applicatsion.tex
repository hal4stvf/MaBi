\chapter{3.Histogramm and first applicatsion}
\section{The histogramm}
%
% Definition histogramm
%
\begin{definition}[histogram]
	Let $\Omega \subset \Z^d$, $F\subset \R$ discrete and 
 	$u: \Omega \to F$ a discrete discrete image. 
 	The function 
 		$$ H_u : F \to \N_0 \; (:= \N \cup \set{0})$$
 	with 
	$$ H_u (k) := \# \set{ x\in \Omega: 
		u(x) = k}, \quad k\in F$$
	is called \emph{histogramm} of the image $u$.
\end{definition}

%
% Bemerkung zum Histrogramm
%
$H_u(k)$ counts how often colour $k$ appears in $u$.
%
	$$ \sum_{k\in F} H_u (k) = |\Omega| 
		= \hbox{number of pixels in the whole  image}$$
or
%
	$$ {H_u(k) \over |\Omega|} = 
		\hbox{relative frequence$%
			_{\lower0.84em\hbox{\hskip-8.1em (relative HÃ¤ufigkeit)}}$ 
				 \hskip-.8em \hbox{of colour $k$ in image $u$}} $$

%
% Beispiel  
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% minipages mit piks
\newcommand{\pikA}{%
	\begin{minipage}{0.14\linewidth}
		\tikzpictureQNINEONE
	\end{minipage}%
}
\newcommand{\pikB}{%
	\begin{minipage}{0.35\linewidth}
		\tikzpictureQNINETWO
	\end{minipage}%
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{bsp}
	$u =$ \pikA has $H_n =$ \pikB  
\end{bsp}

If $u$ ist a continous image, $H_u$ can be understood as
measure (generalized function)\footnote{density
of a probability distribution}. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% Pfeil Befehl
\newcommand{\underarrow}[2]{%
	\newlength{\widthA}
	\newlength{\widthB}
	\settowidth{\widthA}{#1}
	\settowidth{\widthB}{#2}
	%\hbox{\vbox{#1$\uparrow$#2}}%
	\vbox{1\widthA}{#1\\ \hskip-2em\parbox{\widthB}{$\uparrow$\\#2}}
	%_{\lower1em\hbox{$\uparrow$ \\ #2}}
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
{\small 
	Another way to writ this:
	\[ H_u(k) = \sum_{x\in \Omega} 
	\delta _{u(x)}(k),\;
		k \in F \qquad \qquad
		H_u (k) = \int_{\Omega} \delta_{u(x)}(k) dx, \;
		k\in F\]
}
\todoKom{hier fehlt noch das Kronecker underarrow}
\todoKom{Matlab-Code}

%Linabilder 20171023_1256_53

\section{Application: contrast enhancement}

If the image only uses a small part of the available
colour/grayscale \enquote{palette} $F$, then its
contrast can be improved by \enquote{spreading} 
the histogramm over all of $F$.

Simple idea:

\begin{minipage}{\linewidth}
	\tikzpictureQTENONE
\end{minipage}

\begin{minipage}{0.8\linewidth}
	\tikzpictureQTENTWO
\end{minipage}
$\begin{aligned}
	v 		&= \varphi \circ u \\
	v(k)  &= \varphi(u(k))
\end{aligned}$

~\par
The above simple idea (\enquote{contrast stretching}) 
corresponds to
$$ \begin{aligned}
	\varphi: \; &k_{\min} \mapsto 0 \\
						  &k_{\max} \mapsto N \\	
					 		&\text{and linear in between}\\
 \text{i.e} \qquad \quad \varphi(k)  \quad
 							&= \left[\frac {k-k_{\min}} {k_{\max} - k_{\min}}
								\right]	
\end{aligned} $$

Where $ [ \quad \cdot \quad ] $ means \dots rounding to the nearest 
integer (assumuning that $F = \set{0,1,\dots, N}$.

~\par
A bit more sophisticated:
$$ \begin{aligned}
	\varphi: \; (&k_{\min} \mapsto 0) \\
						  &k_{\max} \mapsto N \\	
					 		&\text{and \textbf{non} linear in between}\\
\end{aligned} $$

such that colour ranges that occur more frequently in $u$
can occupy a larger range of colours in $u$. 
($\df$ visibility $\uparrow$)

\newlength{\fittinglinewidth}
\newlength{\phrasewidth}
\settowidth{\phrasewidth}{Example histogramm}
Example histogramm: 
\begin{minipage}{\linewidth-\phrasewidth}
	\tikzpictureQELVENONE  
\end{minipage}

spread out according to frequency of occurence:

\begin{minipage}{\linewidth}
	\tikzpictureQELVENTWO 
\end{minipage}

$\df$ \enquote{density} is equalized over $F = \set{0,\dots,N}$

~\par
{\footnotesize
	Ideal would be: 

	\begin{minipage}{\linewidth}
	 	\tikzpictureQELVENTHREE 
	\end{minipage}
}

~\par
\todoLayout[Layout S.12 u]
Note: The new colours (i.e the location of the bars 
in the histogramm of $u$) only depend on the
frequencies / \emph{height} of the bars in $H_u$
but not on the colours/location of the bars in $H_u$

~\par
Finally: The formula
	$$ \varphi(k) = \left[ \frac {N} {|\Omega|} 
	\sum_{l=0}^{k} H_u (l) \right]$$

This process is called \enquote{histogramm equalization}

\todoKom{Exercise ?!}

\section{Another application: conversion to b/w}	
